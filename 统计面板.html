<!-- ç»Ÿè®¡é¢æ¿å¼¹çª— -->
<style type="text/css">
    /* ==========================================
   ç»Ÿè®¡é¢æ¿æ ·å¼
   ========================================== */

.statistics-modal {
    max-width: 500px;
}

.stats-overview {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
}

.stat-card {
    background: var(--gray-50);
    padding: var(--spacing-md);
    border-radius: var(--radius-md);
    text-align: center;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-color);
    line-height: 1;
    margin-bottom: var(--spacing-xs);
}

.stat-label {
    font-size: 0.85rem;
    color: var(--gray-600);
}

.stats-section {
    margin-bottom: var(--spacing-lg);
}

.stats-section h3 {
    font-size: 1rem;
    color: var(--gray-700);
    margin-bottom: var(--spacing-sm);
    padding-bottom: var(--spacing-xs);
    border-bottom: 1px solid var(--gray-200);
}

.streak-display {
    display: flex;
    justify-content: space-around;
    padding: var(--spacing-md);
    background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
    border-radius: var(--radius-md);
    color: white;
}

.streak-item {
    text-align: center;
}

.streak-value {
    display: block;
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1;
}

.streak-label {
    font-size: 0.8rem;
    opacity: 0.9;
}

.best-times {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.best-time-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--gray-50);
    border-radius: var(--radius-sm);
}

.difficulty-label {
    font-weight: 500;
}

.time-value {
    font-family: monospace;
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-color);
}

.total-time {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--gray-700);
    text-align: center;
    padding: var(--spacing-md);
    background: var(--gray-50);
    border-radius: var(--radius-md);
}

</style>
<div id="statistics-modal" class="modal-overlay">
    <div class="modal statistics-modal">
        <div class="modal-header">
            <h2 data-i18n="statistics.title">æ¸¸æˆç»Ÿè®¡</h2>
            <button class="modal-close" data-close-modal>&times;</button>
        </div>
        
        <div class="modal-body">
            <!-- æ€»è§ˆç»Ÿè®¡ -->
            <div class="stats-overview">
                <div class="stat-card">
                    <div class="stat-value" id="stat-games-played">0</div>
                    <div class="stat-label" data-i18n="statistics.gamesPlayed">æ¸¸æˆæ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-games-completed">0</div>
                    <div class="stat-label" data-i18n="statistics.gamesCompleted">å®Œæˆæ¬¡æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-completion-rate">0%</div>
                    <div class="stat-label" data-i18n="statistics.completionRate">å®Œæˆç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-words-completed">0</div>
                    <div class="stat-label" data-i18n="statistics.wordsCompleted">å®Œæˆå•è¯</div>
                </div>
            </div>
            
            <!-- è¿èƒœè®°å½• -->
            <div class="stats-section">
                <h3>ğŸ”¥ è¿èƒœè®°å½•</h3>
                <div class="streak-display">
                    <div class="streak-item">
                        <span class="streak-value" id="stat-current-streak">0</span>
                        <span class="streak-label" data-i18n="statistics.currentStreak">å½“å‰è¿èƒœ</span>
                    </div>
                    <div class="streak-item">
                        <span class="streak-value" id="stat-best-streak">0</span>
                        <span class="streak-label" data-i18n="statistics.bestStreak">æœ€ä½³è¿èƒœ</span>
                    </div>
                </div>
            </div>
            
            <!-- æœ€ä½³æ—¶é—´ -->
            <div class="stats-section">
                <h3 data-i18n="statistics.bestTimes">ğŸ† æœ€ä½³æ—¶é—´</h3>
                <div class="best-times">
                    <div class="best-time-item">
                        <span class="difficulty-label" data-i18n="difficulty.easy">ç®€å•</span>
                        <span class="time-value" id="best-time-easy">--:--</span>
                    </div>
                    <div class="best-time-item">
                        <span class="difficulty-label" data-i18n="difficulty.medium">ä¸­ç­‰</span>
                        <span class="time-value" id="best-time-medium">--:--</span>
                    </div>
                    <div class="best-time-item">
                        <span class="difficulty-label" data-i18n="difficulty.hard">å›°éš¾</span>
                        <span class="time-value" id="best-time-hard">--:--</span>
                    </div>
                </div>
            </div>
            
            <!-- æ€»ç”¨æ—¶ -->
            <div class="stats-section">
                <h3 data-i18n="statistics.totalTime">â±ï¸ æ€»ç”¨æ—¶</h3>
                <div class="total-time" id="stat-total-time">0å°æ—¶ 0åˆ†é’Ÿ</div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button id="btn-close-stats" class="btn btn-primary" data-i18n="buttons.close">
                å…³é—­
            </button>
        </div>
    </div>
</div>

<script type="text/javascript">
    /**
 * ç»Ÿè®¡é¢æ¿æ§åˆ¶å™¨
 */
const StatisticsController = {
    /**
     * åˆå§‹åŒ–
     */
    init() {
        this._bindEvents();
    },
    
    /**
     * ç»‘å®šäº‹ä»¶
     */
    _bindEvents() {
        document.getElementById('btn-close-stats')?.addEventListener('click', () => {
            this.close();
        });
        
        document.getElementById('statistics-modal')?.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                this.close();
            }
        });
    },
    
    /**
     * æ‰“å¼€ç»Ÿè®¡é¢æ¿
     */
    open() {
        this._updateDisplay();
        document.getElementById('statistics-modal')?.classList.add('active');
        
        // æ•°å­—åŠ¨ç”»
        if (AnimationManager.enabled) {
            this._animateNumbers();
        }
    },
    
    /**
     * å…³é—­ç»Ÿè®¡é¢æ¿
     */
    close() {
        document.getElementById('statistics-modal')?.classList.remove('active');
    },
    
    /**
     * æ›´æ–°æ˜¾ç¤º
     */
    _updateDisplay() {
        const stats = StorageManager.getStatistics() || {};
        
        // åŸºç¡€ç»Ÿè®¡
        document.getElementById('stat-games-played').textContent = 
            stats.totalGamesPlayed || 0;
        document.getElementById('stat-games-completed').textContent = 
            stats.totalGamesCompleted || 0;
        document.getElementById('stat-words-completed').textContent = 
            stats.totalWordsCompleted || 0;
        
        // å®Œæˆç‡
        const rate = stats.totalGamesPlayed > 0 
            ? Math.round((stats.totalGamesCompleted / stats.totalGamesPlayed) * 100)
            : 0;
        document.getElementById('stat-completion-rate').textContent = rate + '%';
        
        // è¿èƒœ
        document.getElementById('stat-current-streak').textContent = 
            stats.streaks?.current || 0;
        document.getElementById('stat-best-streak').textContent = 
            stats.streaks?.best || 0;
        
        // æœ€ä½³æ—¶é—´
        const bestTimes = stats.bestTimes || {};
        ['easy', 'medium', 'hard'].forEach(diff => {
            const el = document.getElementById(`best-time-${diff}`);
            if (el) {
                el.textContent = bestTimes[diff] 
                    ? Utils.formatTime(bestTimes[diff])
                    : '--:--';
            }
        });
        
        // æ€»ç”¨æ—¶
        const totalSeconds = stats.totalTimePlayed || 0;
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        document.getElementById('stat-total-time').textContent = 
            `${hours}${I18n.t('time.hours')} ${minutes}${I18n.t('time.minutes')}`;
    },
    
    /**
     * æ•°å­—åŠ¨ç”»æ•ˆæœ
     */
    _animateNumbers() {
        const stats = StorageManager.getStatistics() || {};
        
        const animations = [
            ['stat-games-played', 0, stats.totalGamesPlayed || 0],
            ['stat-games-completed', 0, stats.totalGamesCompleted || 0],
            ['stat-words-completed', 0, stats.totalWordsCompleted || 0]
        ];
        
        animations.forEach(([id, from, to], index) => {
            const el = document.getElementById(id);
            if (el) {
                setTimeout(() => {
                    AnimationManager.countUp(el, from, to, 800);
                }, index * 150);
            }
        });
    }
};
</script>